<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AIRA</title>

  <!-- favicon -->
  <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
  <link rel="shortcut icon" type="image/x-icon" href="assets/favicon.ico">

  <style>
/* Reset */
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%}
html{background:#000}
body{font:16px/1.6 "Segoe UI",system-ui,-apple-system,"PingFang SC","Microsoft YaHei",sans-serif;color:#fff;overflow:hidden}

/* 背景 */
#scene-container{position:fixed;inset:0;z-index:0;pointer-events:none;background:url('./assets/image/bg-home.jpg') center/cover no-repeat fixed}
#scene-container::after{content:"";position:absolute;inset:0;background:radial-gradient(60% 50% at 50% 65%,rgba(0,0,0,.25),rgba(0,0,0,.65) 70%)}
#particle-canvas{position:fixed;top:0;left:0;right:0;bottom:0;pointer-events:none;z-index:1}

/* 顶部导航（保留原结构） */
.nav-left{
  position:fixed; top:18px; left:24px;
  z-index:3; display:flex; align-items:center;
}
.nav-left .nav-logo img{ width:28px; height:28px; display:block; }

.nav-right{
  position:fixed; top:18px; right:24px;
  z-index:3; display:flex; align-items:center; gap:24px;
}

/* 右上链接：金色下划线动态特效 */
.nav-right a{
  color:#f5f5f5; text-decoration:none; font-size:.95rem;
  opacity:.92; position:relative; padding-bottom:4px; transition:opacity .25s ease;
}
.nav-right a:hover{ opacity:1; }
.nav-right a::after{
  content:""; position:absolute; left:0; bottom:0; width:100%; height:2px;
  background:linear-gradient(90deg,#e8bd63,#ffd889);
  transform:scaleX(0); transform-origin:left; transition:transform .28s ease;
}
.nav-right a:hover::after{ transform:scaleX(1); }

/* 只保留按钮，放在底部 1/4 中心 */
.center-text{
  position:absolute; left:50%; top:75%;
  transform:translate(-50%,-50%);
  text-align:center; z-index:2;
}

/* 无边框发光下划线按钮 */
.btn{
  background:transparent; border:none; color:#fff;
  font-size:1.2rem; letter-spacing:.15em; cursor:pointer;
  position:relative; text-transform:uppercase; padding:8px 12px;
  transition:color .3s ease;
}
.btn::after{
  content:""; position:absolute; left:0; bottom:0; width:100%; height:2px;
  background:linear-gradient(90deg,#ffcc66,#ff9900);
  transform:scaleX(0); transform-origin:right; transition:transform .35s ease;
  box-shadow:0 0 12px rgba(255,200,100,.7);
}
.btn:hover{ color:#ffd580; }
.btn:hover::after{ transform:scaleX(1); transform-origin:left; }

/* 音频隐藏 + 画布显式 */
audio{display:none}
#scene-container::after{display:none !important}
#particle-canvas{position:fixed;top:0;left:0;right:0;bottom:0;pointer-events:none;z-index:1;display:block !important}

/* 登录弹窗 */
.modal-overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.55);backdrop-filter:blur(3px);z-index:10}
.modal-overlay.show{display:flex}
.modal{width:360px;max-width:92vw;background:rgba(20,20,20,.92);border:1px solid rgba(230,196,122,.35);border-radius:16px;box-shadow:0 20px 80px rgba(0,0,0,.55);padding:22px}
.modal h3{font-size:20px;margin:0 0 14px;font-weight:700;letter-spacing:.05em}
.modal .form-row{margin:10px 0}
.modal label{display:block;margin-bottom:6px;color:#ddd;font-size:.9rem}
.modal input{width:100%;padding:10px 12px;border:1px solid rgba(255,255,255,.18);background:rgba(255,255,255,.05);color:#fff;border-radius:10px;outline:0}
.modal .actions{display:flex;gap:10px;margin-top:12px}
.btn-primary{background:rgba(255,159,0,.9);border-color:rgba(255,159,0,.9);color:#000}
.btn-ghost{background:transparent;border-color:rgba(255,255,255,.25)}
.error{margin-top:8px;color:#ffb4b4;font-size:.85rem;display:none}
.modal-close{position:absolute;top:10px;right:12px;background:transparent;border:0;color:#bbb;font-size:20px;cursor:pointer}
.modal-close:hover{color:#fff}
  </style>
</head>
<body>
  <!-- 背景 -->
  <div id="scene-container"></div>
  <canvas id="particle-canvas"></canvas>

  <!-- 左侧 logo -->
  <div class="nav-left">
    <a href="#" class="nav-logo" aria-label="Home">
      <img src="assets/favicon.ico" alt="Logo">
    </a>
  </div>

  <!-- 右侧菜单：解锁 与 登录/登出 分开 -->
  <div class="nav-right">
    <a href="#">BAZI</a>
    <a href="#">19002000113</a>
    <a href="#" id="unlockLink">unlock</a>
    <a href="#" id="loginLink">Login</a>
  </div>

  <!-- 只留按钮，定位在底部 1/4 中心 -->
  <div class="center-text">
    <button class="btn">Enter</button>
  </div>
  
  <!-- 登录弹窗 -->
  <div class="modal-overlay" id="loginModal" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
      <button class="modal-close" id="loginClose" aria-label="关闭">×</button>
      <h3 id="loginTitle">账号登录</h3>
      <form id="loginForm">
        <div class="form-row">
          <label for="loginUser">账号</label>
          <input id="loginUser" type="text" placeholder="admin" autocomplete="username" required />
        </div>
        <div class="form-row">
          <label for="loginPass">密码</label>
          <input id="loginPass" type="password" placeholder="123456" autocomplete="current-password" required />
        </div>
        <div class="actions">
          <button type="submit" class="btn btn-primary" id="loginSubmit">登录</button>
          <button type="button" class="btn btn-ghost" id="loginCancel">取消</button>
        </div>
        <div class="error" id="loginError">账号或密码不正确</div>
      </form>
    </div>
  </div>

  <!-- 背景音乐 -->
  <audio id="bgMusic" src="./assets/media/background.mp3" loop autoplay></audio>

  <!-- 画布霓虹（保持你的逻辑） -->
  <script>
(function(){
  const cvs=document.getElementById('particle-canvas'); if(!cvs) return; const ctx=cvs.getContext('2d');
  const IMG={w:2912,h:1632};
  let DPR=1,W=0,H=0,S=1,OX=0,OY=0;
  function computeCover(){S=Math.max(W/IMG.w,H/IMG.h);OX=(W-IMG.w*S)/2;OY=(H-IMG.h*S)/2;}
  function screenFromImage(ix,iy){return[OX+ix*S,OY+iy*S];}
  function resize(){DPR=Math.max(1,devicePixelRatio||1);W=Math.floor(innerWidth);H=Math.floor(innerHeight);cvs.width=Math.floor(W*DPR);cvs.height=Math.floor(H*DPR);cvs.style.width=W+'px';cvs.style.height=H+'px';ctx.setTransform(DPR,0,0,DPR,0,0);computeCover();}
  resize();addEventListener('resize',resize);

  const PATH={imgPts:[[1,1257],[1359,1073],[2100,971],[2377,930],[2061,875],[1185,790]],normalSide:1,baseOffset:0};
  const STYLE={bars:168,barWidth:4,maxLenRatio:0.18,gamma:1.25,glow:24,core1:'rgba(255,240,210,0.95)',core2:'rgba(230,196,122,0.85)',tail:'rgba(208,162,74,0.10)',glowC:'rgba(230,196,122,0.55)',baseLine:'rgba(255,220,160,0.35)',baseLineWidth:2.2};
  function CR(p0,p1,p2,p3,t){const t2=t*t,t3=t2*t;const x=.5*((2*p1[0])+(-p0[0]+p2[0])*t+(2*p0[0]-5*p1[0]+4*p2[0]-p3[0])*t2+(-p0[0]+3*p1[0]-3*p2[0]+p3[0])*t3);const y=.5*((2*p1[1])+(-p0[1]+p2[1])*t+(2*p0[1]-5*p1[1]+4*p2[1]-p3[1])*t2+(-p0[1]+3*p1[1]-3*p2[1]+p3[1])*t3);return[x,y];}
  function CRPoint(pts,t){const n=pts.length-1;if(n<1)return pts[0];const seg=Math.min(n-1,Math.floor(t*n));const lt=t*n-seg;const p0=pts[Math.max(0,seg-1)],p1=pts[seg],p2=pts[Math.min(seg+1,n)],p3=pts[Math.min(seg+2,n)];return CR(p0,p1,p2,p3,lt);}
  function splinePos(pts,t){const p=CRPoint(pts,t);return screenFromImage(p[0],p[1]);}

  const audio=document.getElementById('bgMusic');let AC,ACtx,analyser,data;
  function ensureAudio(){if(analyser)return;AC=window.AudioContext||window.webkitAudioContext;if(!AC)return;ACtx=new AC();analyser=ACtx.createAnalyser();analyser.fftSize=1024;analyser.smoothingTimeConstant=.85;data=new Uint8Array(analyser.frequencyBinCount);const src=ACtx.createMediaElementSource(audio);src.connect(analyser);analyser.connect(ACtx.destination);}
  function resume(){try{if(ACtx&&ACtx.state==='suspended')ACtx.resume();}catch(e){}}
  const unlock=()=>{ensureAudio();audio.play().catch(()=>{});resume();removeEventListener('pointerdown',unlock);removeEventListener('keydown',unlock);};
  addEventListener('pointerdown',unlock);addEventListener('keydown',unlock);

  function drawNeonBase(pts, style){
    const ctx=cvs.getContext('2d');
    ctx.save();ctx.shadowBlur=22;ctx.shadowColor=style.glowC;ctx.lineWidth=style.baseLineWidth;ctx.strokeStyle=style.baseLine;
    ctx.beginPath();const steps=420;
    for(let i=0;i<=steps;i++){const t=i/steps;const [x,y]=splinePos(pts,t);if(i===0)ctx.moveTo(x,y);else ctx.lineTo(x,y);}
    ctx.stroke();ctx.restore();
  }

  function frame(){
    const ctx=cvs.getContext('2d');const W=cvs.width/(devicePixelRatio||1),H=cvs.height/(devicePixelRatio||1);
    ctx.clearRect(0,0,W,H);drawNeonBase(PATH.imgPts,STYLE);
    if(analyser&&data){analyser.getByteFrequencyData(data);
      (function(){
        const N=STYLE.bars,usable=Math.floor(data.length*.75),start=2,step=Math.max(1,Math.floor((usable-start)/N)),maxLen=Math.min(W,H)*STYLE.maxLenRatio,tips=[];
        for(let i=0;i<N;i++){const t=i/(N-1);const [bx,by]=splinePos(PATH.imgPts,t);const v=data[start+i*step]||0;const amp=Math.pow(v/255,STYLE.gamma);const imgP=CRPoint(PATH.imgPts,t);const yRatio=Math.min(1,Math.max(0,imgP[1]/IMG.h));const pf=.6+.4*yRatio;const len=amp*maxLen*pf;const x1=bx,y1=by,x2=x1,y2=y1-1*PATH.normalSide*len;
          ctx.save();ctx.lineCap='round';ctx.shadowBlur=STYLE.glow;ctx.shadowColor=STYLE.glowC;ctx.strokeStyle='rgba(230,196,122,0.25)';ctx.lineWidth=STYLE.barWidth+8;ctx.beginPath();ctx.moveTo(x1,y1);ctx.lineTo(x2,y2);ctx.stroke();ctx.restore();
          const g=ctx.createLinearGradient(x1,y1,x2,y2);g.addColorStop(0,STYLE.tail);g.addColorStop(.6,STYLE.core2);g.addColorStop(1,STYLE.core1);ctx.lineCap='round';ctx.strokeStyle=g;ctx.lineWidth=STYLE.barWidth;ctx.beginPath();ctx.moveTo(x1,y1);ctx.LineTo?ctx.lineTo(x2,y2):ctx.lineTo(x2,y2);ctx.stroke();tips.push([x2,y2]);}
        if(tips.length>2){ctx.save();ctx.shadowBlur=20;ctx.shadowColor='rgba(255,236,190,0.65)';ctx.lineWidth=2;ctx.strokeStyle='rgba(255,240,210,0.85)';ctx.beginPath();for(let i=0;i<tips.length;i++){const [x,y]=tips[i];if(i===0)ctx.moveTo(x,y);else{const [px,py]=tips[i-1];const mx=(px+x)/2,my=(py+y)/2;ctx.quadraticCurveTo(px,py,mx,my);}}ctx.stroke();ctx.restore();}
      })();
    }
    requestAnimationFrame(frame);
  }
  requestAnimationFrame(frame);
})();
  </script>

  <!-- 登录/解锁逻辑（强校验版） -->
  <script>
(function(){
  const AUTH_KEY = 'FEI_AUTH_USER';          // 已登录用户名（localStorage）
  const UNLOCK_OK = 'FEI_UNLOCK_OK';         // 本会话是否已解锁（sessionStorage）

  // 密文：{"u":"FEI","p":"QazWsx147."}
  const ENC = {
    alg : 'XOR-SHA256',
    salt: 'OK6n1TcKE6/wwqMOmAaj7Q==',
    ct  : 'xEcJUJDN0OGALuYWpxGVHjw6aKeq4CCgC8IdX4oQqw=='
  };

  // DOM
  const $ = s => document.querySelector(s);
  const modal = $('#loginModal');
  const loginLink  = $('#loginLink');   // Login / logout
  const unlockLink = $('#unlockLink');  // unlock
  const closeBtn   = $('#loginClose');
  const cancelBtn  = $('#loginCancel');
  const form  = $('#loginForm');
  const user  = $('#loginUser');
  const pass  = $('#loginPass');
  const errorEl = $('#loginError');

  // 工具
  const te = new TextEncoder(), td = new TextDecoder();
  const b64 = s => Uint8Array.from(atob(s), c => c.charCodeAt(0));

  async function keystream(pass, salt, n){
    const passBytes = te.encode(pass);
    const out = new Uint8Array(n);
    for (let produced = 0, i = 0; produced < n; i++){
      const ctr = new Uint8Array(4);
      new DataView(ctr.buffer).setUint32(0, i, true);
      const buf = new Uint8Array(passBytes.length + salt.length + 4);
      buf.set(passBytes, 0);
      buf.set(salt, passBytes.length);
      buf.set(ctr, passBytes.length + salt.length);
      const h = new Uint8Array(await crypto.subtle.digest('SHA-256', buf));
      const take = Math.min(h.length, n - produced);
      out.set(h.subarray(0, take), produced);
      produced += take;
    }
    return out;
  }

  async function tryUnlock(passphrase){
    const salt = b64(ENC.salt);
    const ct   = b64(ENC.ct);
    const ks   = await keystream(passphrase, salt, ct.length);
    const pt   = new Uint8Array(ct.length);
    for (let i=0;i<ct.length;i++) pt[i] = ct[i]^ks[i];
    const txt = td.decode(pt);

    const parsed = JSON.parse(txt);
    if (!parsed || typeof parsed.u !== 'string' || typeof parsed.p !== 'string'){
      throw new Error('invalid payload');
    }
    return parsed; // {u,p}
  }

  // 状态：进入页面即重置本会话的解锁标记
  sessionStorage.removeItem(UNLOCK_OK);
  let SECRET = null;

  function isLoggedIn(){ return !!localStorage.getItem(AUTH_KEY); }
  function isUnlocked(){ return sessionStorage.getItem(UNLOCK_OK) === '1' && !!SECRET; }

  // UI
  function show(){ if(!modal) return; modal.classList.add('show'); modal.setAttribute('aria-hidden','false'); errorEl && (errorEl.style.display='none'); user && user.focus(); }
  function hide(){ if(!modal) return; modal.classList.remove('show'); modal.setAttribute('aria-hidden','true'); }
  function logout(){ localStorage.removeItem(AUTH_KEY); updateUI(); }

  function updateUI(){
    if(!loginLink) return;
    if (isLoggedIn()){
      loginLink.textContent = 'logout';
      loginLink.onclick = (e)=>{ e.preventDefault(); logout(); };
    } else {
      loginLink.textContent = 'Login';
      loginLink.onclick = (e)=>{ e.preventDefault(); show(); };
    }
  }

  // 解锁（必须正确口令）
  async function promptUnlock(){
    const pw = prompt('输入解锁口令：'); // 示例：My$trongUnlock!
    if (pw === null) return; // 取消
    try{
      const creds = await tryUnlock(pw); // 错误会 throw
      SECRET = creds;                                   // 只存内存
      sessionStorage.setItem(UNLOCK_OK, '1');           // 本会话标记
      alert('解锁成功：可以进行登录验证。');
    }catch(e){
      SECRET = null;
      sessionStorage.removeItem(UNLOCK_OK);
      alert('解锁失败：口令错误。');
    }
  }

  // 绑定 unlock
  unlockLink && unlockLink.addEventListener('click', (e)=>{ e.preventDefault(); promptUnlock(); });

  // 长按左上角 logo 触发解锁（可选）
  (function addLongPress(){
    const area = document.querySelector('.nav-left');
    if(!area) return;
    let timer=null;
    const start = ()=>{ timer = setTimeout(()=>{ timer=null; promptUnlock(); }, 700); };
    const cancel= ()=>{ if(timer){ clearTimeout(timer); timer=null; } };
    area.addEventListener('touchstart', start, {passive:true});
    area.addEventListener('mousedown',  start);
    ['touchend','touchcancel','mouseup','mouseleave'].forEach(ev=>area.addEventListener(ev, cancel));
  })();

  // 登录提交：要求先解锁
  form && form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    if (!isUnlocked()){
      alert('未解锁：请先点击右上角 “unlock” 输入口令。');
      errorEl && (errorEl.style.display='block');
      return;
    }
    const u = (user?.value || '').trim();
    const p = (pass?.value || '').trim();
    if (u === SECRET.u && p === SECRET.p){
      localStorage.setItem(AUTH_KEY, u);
      hide();
      updateUI();
    } else {
      errorEl && (errorEl.style.display='block');
    }
  });

  // 保护：未登录不允许前往 input.html
  document.addEventListener('click', (e)=>{
    let el = e.target;
    while(el && el !== document){
      if(el.matches('a[href$="input.html"], a[href*="/input.html"], button[href$="input.html"], button[data-go="input"]')){
        if(!isLoggedIn()){
          e.preventDefault();
          e.stopPropagation();
          show();
          return;
        }
      }
      el = el.parentElement;
    }
  }, true);

  // 首页 Enter 按钮：先检查登录
  const goBtn = document.querySelector('.center-text .btn');
  if (goBtn){
    goBtn.addEventListener('click', (e)=>{
      if(!isLoggedIn()){ e.preventDefault(); show(); }
      else{ location.href = 'input.html'; }
    });
  }

  updateUI();
})();
  </script>
</body>
</html>
